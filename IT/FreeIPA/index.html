
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.1.3">
    
    
      
        <title>FreeIPA Introduction - Nicolas GORALSKI docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.edf004c2.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#freeipa-introduction" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Nicolas GORALSKI docs" class="md-header__button md-logo" aria-label="Nicolas GORALSKI docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Nicolas GORALSKI docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              FreeIPA Introduction
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Nicolas GORALSKI docs" class="md-nav__button md-logo" aria-label="Nicolas GORALSKI docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Nicolas GORALSKI docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../combine.md" class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../softs/" class="md-nav__link">
        Softs
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          IT
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="IT" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          IT
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../freeipa/" class="md-nav__link">
        freeipa
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../linux-best-practices/" class="md-nav__link">
        Linux Best Practices
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../bookmarks/" class="md-nav__link">
        Bookmarks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cheatsheets/" class="md-nav__link">
        Cheatsheets
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Domotic
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Domotic" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Domotic
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Tasmota
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../domoticz/combine.md" class="md-nav__link">
        Domoticz
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#about" class="md-nav__link">
    About
  </a>
  
    <nav class="md-nav" aria-label="About">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#objectives" class="md-nav__link">
    Objectives
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    Requirements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    References
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-installation" class="md-nav__link">
    Core Installation
  </a>
  
    <nav class="md-nav" aria-label="Core Installation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prepare-the-machine" class="md-nav__link">
    Prepare the machine
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-the-software" class="md-nav__link">
    Install the software
  </a>
  
    <nav class="md-nav" aria-label="Install the software">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#firewall" class="md-nav__link">
    Firewall
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-freeipa" class="md-nav__link">
    Configure FreeIPA
  </a>
  
    <nav class="md-nav" aria-label="Configure FreeIPA">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#user-management" class="md-nav__link">
    User Management
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nfs-mount-configuration-for-homedir" class="md-nav__link">
    NFS Mount configuration for homedir
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux" class="md-nav__link">
    Linux
  </a>
  
    <nav class="md-nav" aria-label="Linux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#linux-nfs-server" class="md-nav__link">
    Linux NFS Server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux-ipa-client" class="md-nav__link">
    Linux IPA Client
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#freebsd" class="md-nav__link">
    FreeBSD
  </a>
  
    <nav class="md-nav" aria-label="FreeBSD">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#freebsd-nfs-server" class="md-nav__link">
    FreeBSD NFS Server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#freebsd-ipa-client" class="md-nav__link">
    FreeBSD IPA Client
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rules" class="md-nav__link">
    Rules
  </a>
  
    <nav class="md-nav" aria-label="Rules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#allow-some-users-to-connect-throught-ssh" class="md-nav__link">
    Allow some users to connect throught ssh
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#allow-some-users-to-excute-commands-with-sudo" class="md-nav__link">
    Allow some users to excute commands with sudo
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

<h1 id="freeipa-introduction">FreeIPA Introduction</h1>
<h2 id="about">About</h2>
<p>In order to make my infrastructure more easy to manage, I decide to install a FreeIPA server.
One of my former colleague and now friend talk me a lot about this product times ago.
So I decided to try it.</p>
<p>NB. This article is not finish yet, so some typos can still be included or paragraph not yet formatted.</p>
<h3 id="objectives">Objectives</h3>
<p>Install a functional FreeIPA server to:</p>
<ul>
<li>manage users, groups, automount</li>
<li>centralise ssh user public keys</li>
</ul>
<p>This is the first step, I will add new modules like</p>
<ul>
<li>FreeOTP</li>
</ul>
<h3 id="requirements">Requirements</h3>
<ul>
<li>a CentOS machine (10G HD System, 1 VCPU, 2G RAM )</li>
<li>a local domain name like myplace.local</li>
</ul>
<h3 id="references">References</h3>
<p>This article is base on:</p>
<ul>
<li><a href="http://www.freeipa.org/page/Quick_Start_Guide" title="FreeIPA Quick Start Guide">FreeIPA</a></li>
<li><a href="https://www.unixmen.com/configure-freeipa-server-centos-7/" title="FreeIPA on CentOS 7">UnixMen</a></li>
</ul>
<h2 id="core-installation">Core Installation</h2>
<h3 id="prepare-the-machine">Prepare the machine</h3>
<p>Add your machine ip and name in your /etc/hosts file</p>
<div class="highlight"><pre><span></span><code>echo &quot;$(ip -o -4 addr show  | grep -v &quot; lo&quot; | head -1 | awk {&#39;print $4&#39;} | cut -d&#39;/&#39; -f1) $(hostname) $(hostname -s)&quot; &gt;&gt; /etc/hosts
</code></pre></div>
<p>That would add something like :</p>
<div class="highlight"><pre><span></span><code>10.0.0.1 ipaserver.myplace.local ipaserver
</code></pre></div>
<h3 id="install-the-software">Install the software</h3>
<p>Install the requirements to set up everything :</p>
<div class="highlight"><pre><span></span><code>yum install ipa-server bind-dyndb-ldap ipa-server-dns
</code></pre></div>
<p>Prepare the following infos before executing the installation process:</p>
<ul>
<li>domain name (myplace.local) will be determined based on machine hostname, you just have to confirm it</li>
<li>Directory Manager password</li>
<li>IPA admin password</li>
<li>A DNS Forwarder</li>
</ul>
<p>Then execute the following command and <strong>answer the questions</strong></p>
<div class="highlight"><pre><span></span><code>ipa-server-install --setup-dns
</code></pre></div>
<p>At the end the following message will appear :</p>
<blockquote>
<p>Be sure to back up the CA certificates stored in /root/cacert.p12
These files are required to create replicas. The password for these 
files is the Directory Manager password</p>
</blockquote>
<p><strong>Backup this file !! </strong></p>
<h4 id="firewall">Firewall</h4>
<p>if you want to use the local firewall on the centos, allow incoming traffic:</p>
<div class="highlight"><pre><span></span><code>firewall-cmd --permanent --add-service=ntp
firewall-cmd --permanent --add-service=http
firewall-cmd --permanent --add-service=https
firewall-cmd --permanent --add-service=ldap
firewall-cmd --permanent --add-service=ldaps
firewall-cmd --permanent --add-service=kerberos
firewall-cmd --permanent --add-service=kpasswd
</code></pre></div>
<p>If you want to use your FreeIPA to handle also the PKI part, add the RootCA, located in /etc/ipa/ca.crt, in your firefox or system's CA.</p>
<h2 id="configure-freeipa">Configure FreeIPA</h2>
<p>Everything can be done through a web interface or commands lines.
I will use command line.
The web interface is reachable through https://ipaserver.myplace.local/</p>
<h3 id="user-management">User Management</h3>
<p>A NFS Server will be used in order to have a unique point of storage for homedir.
This will avoid multiple time the same data over multiple machine.</p>
<p>The NFS Server will be a freebsd server with ZFS Storage.</p>
<h3 id="nfs-mount-configuration-for-homedir">NFS Mount configuration for homedir</h3>
<p>On FreeIPA Server execute the following command:</p>
<div class="highlight"><pre><span></span><code>ipa automountmap-add default auto.home

Added automount map &quot;auto.home&quot;

  Map: auto.home


ipaserver# ipa automountkey-add default --key &quot;/exports/home&quot; --info auto.home auto.master

Added automount key &quot;/exports/home&quot;

  Key: /exports/home
  Mount information: auto.home


ipaserver# ipa automountkey-add default --key &quot;*&quot; --info &quot;-fstype=nfs4,rw,sec=krb5,soft,rsize=8192,wsize=8192 nfssrv.myplace.local:/exports/home/&amp;&quot; auto.home

Added automount key &quot;*&quot;

  Key: *
  Mount information: -fstype=nfs4,rw,sec=krb5,soft,rsize=8192,wsize=8192 nfssrv.myplace.local:/exports/home/&amp;
</code></pre></div>
<p>On Linux machines ensure that home dir will be created automatically if it doesn't exist.</p>
<div class="highlight"><pre><span></span><code>authconfig --enablemkhomedir --update
</code></pre></div>
<h3 id="linux">Linux</h3>
<h4 id="linux-nfs-server">Linux NFS Server</h4>
<p>Source :</p>
<ul>
<li><a href="https://blog.delouw.ch/2015/03/14/using-ipa-to-provide-automount-maps-for-nfsv4-home-directories/">blog delouw</a></li>
</ul>
<p>Configure sssd + krb5.conf</p>
<div class="highlight"><pre><span></span><code>ipa service-add nfs/nfssrv.myplace.local
ipa-getkeytab -s ipasrv.myplace.local -p nfs/nfssrv.myplace.local -k /etc/krb5.keytab
</code></pre></div>
<h4 id="linux-ipa-client">Linux IPA Client</h4>
<div class="highlight"><pre><span></span><code>ipa-server# ipa host-add ipaclient2.myplace.local --ip-address=A.B.C.D
ipa-server# ipa service-add nfs/ipaclient2.myplace.local


ipa-client# yum install ipa-client
ipa-client# mkdir -p /exports/home
ipa-client# authconfig --enablemkhomedir --update
ipa-client# generate /etc/krb5.conf
ipa-client# kinit
ipa-client# ipa-getkeytab -s ipasrv.myplace.local -p nfs/${HOSTNAME} -k /etc/krb5.keytab
</code></pre></div>
<p>Then :</p>
<div class="highlight"><pre><span></span><code>ipa-client# ipa-client-install
</code></pre></div>
<p>Or</p>
<div class="highlight"><pre><span></span><code>ipa-client# ipa-client-install --domain=myplace.local --server=ipaserver.myplace.local --realm=MYPLACE.LOCAL
</code></pre></div>
<p>To finish with:</p>
<div class="highlight"><pre><span></span><code>ipa-client# ipa-client-automount --location=default
</code></pre></div>
<p>Ensure that the automount is working execute the following command:</p>
<div class="highlight"><pre><span></span><code>mount | grep auto
</code></pre></div>
<p>The result should be like :</p>
<blockquote>
<p>auto.home on /exports/home type autofs (rw,relatime,fd=18,pgrp=19004,timeout=300,minproto=5,maxproto=5,indirect)</p>
</blockquote>
<p>If not edit /etc/nsswitch.conf
find the automount line, sss may be missing it should be like :</p>
<p>automount:  files sss</p>
<p>Fix it, restart sssd and autofs.</p>
<h3 id="freebsd">FreeBSD</h3>
<h4 id="freebsd-nfs-server">FreeBSD NFS Server</h4>
<h4 id="freebsd-ipa-client">FreeBSD IPA Client</h4>
<p>Source :
 - https://blog.hostileadmin.com/2016/03/24/integrating-freebsd-w-freeipasssd/
 - https://forums.freebsd.org/threads/46526/</p>
<p>On the FreeBSD Client (not yet functional), compile sssd with smb support 
Edit <em>sssd/Makefile</em>  and add the option <strong><em>--with-krb5-conf=/etc/krb5.conf</em></strong> </p>
<p>(thx https://community.riocities.com/freebsd_nfv4_krb.html)</p>
<div class="highlight"><pre><span></span><code>freebsd_srv# mkdir -p /usr/compat/linux/proc
freebsd_srv# echo &quot;linproc /usr/compat/linux/proc linprocfs rw 0 0&quot; &gt;&gt; /etc/fstab
mkdir /var/log/krb5
</code></pre></div>
<p><strong>edit /etc/pam.d/system</strong></p>
<p>TBF</p>
<p>On the FreeIPA Server execute the following commands</p>
<div class="highlight"><pre><span></span><code>ipaserver# ipa-host-add FREEBSD_FQDN
ipaserver# ipa-getkeytab -s ${HOSTNAME} -p host/FREEBSD_FQDN -k &lt;location to export the keytab&gt;
</code></pre></div>
<p>Now, copy the newly created keytab file to <em>/etc/krb5.keytab</em> on the FreeBSD Client</p>
<p>Add TLS_CACERT /etc/ipa/ca.crt in /usr/local/etc/openldap/ldap.conf</p>
<h3 id="rules">Rules</h3>
<h4 id="allow-some-users-to-connect-throught-ssh">Allow some users to connect throught ssh</h4>
<p>Based on http://www.freeipa.org/page/Howto/HBAC_and_allow_all</p>
<p>Create a new rule name allow_ssh</p>
<div class="highlight"><pre><span></span><code>ipaserver# ipa hbacrule-add allow_ssh

Added HBAC rule &quot;allow_ssh&quot;

  Rule name: allow_ssh
  Enabled: TRUE
</code></pre></div>
<p>Associate newly created HBAC rule</p>
<div class="highlight"><pre><span></span><code>ipaserver# ipa hbacrule-add-service allow_ssh --hbacsvcs=sshd

  Rule name: allow_ssh
  Enabled: TRUE
  Services: sshd

Number of members added 1
</code></pre></div>
<p>Associate a User to this rule</p>
<div class="highlight"><pre><span></span><code>ipaserver# ipa hbacrule-add-user allow_ssh --user=username_allowed

  Rule name: allow_ssh
  Enabled: TRUE
  Users: username_allowed

Number of members added 1

ipaserver# ipa hbacrule-add-host allow_ssh --hosts=ipaclient.myplace.local

  Rule name: allow_ssh
  Enabled: TRUE
  Users: username_allowed
  Hosts: ipaclient.myplace.local

Number of members added 1
</code></pre></div>
<h4 id="allow-some-users-to-excute-commands-with-sudo">Allow some users to excute commands with sudo</h4>
<p>In the previous section about allowing ssh command, I've written the command output, but in the following one, I will not.</p>
<p>Before allowing user to execute specific command through sudo, we need to allow the user to access sudo.</p>
<div class="highlight"><pre><span></span><code>ipaserver# ipa hbacrule-add allow_sudo
ipaserver# ipa hbacrule-add-service allow_sudo --hbacsvcs=sudo
ipaserver# ipa hbacrule-add-user allow_sudo --user=username_allowed
ipaserver# ipa hbacrule-add-host allow_sudo --hosts=ipaclient.myplace.local
</code></pre></div>
<p>Ok now let's allow the user execute a command like whoami.</p>
<p>Beware that sssd is a caching system, so I can take time to refresh the data (up to 6h)
 - Incrementally, meaning only changes to rule since the last full update (ldap_sudo_smart_refresh_interval, the time in seconds); the default is 15 minutes,
 - Fully, which dumps the entire caches and pulls all the current rules on the LDAP server(ldap_sudo_full_refresh_interval, the time in seconds); the default is six hours.</p>
<p>Source <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Deployment_Guide/sssd-ldap-sudo.html" title="sssd-ldap-sudo">sssd-ldap-sudo</a></p>
<div class="highlight"><pre><span></span><code>ipaserver# ipa sudorule-add whoami
ipaserver# ipa sudocmd-add /usr/bin/whoami
ipaserver# ipa sudorule-add-allow-command whoami --sudocmds /usr/bin/whoami
ipaserver# ipa sudorule-add-host whoami --hosts ipaclient.myplace.local
ipaserver# ipa sudorule-add-user whoami --users username_allowed
</code></pre></div>
<p>Now if we want to allow executing sudo whoami without autenticate the user we add this:</p>
<div class="highlight"><pre><span></span><code>ipaserver# ipa sudorule-add-option whoami --sudooption &#39;!authenticate&#39;
</code></pre></div>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.0bbba5b5.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.e1a181d9.min.js"></script>
      
    
  </body>
</html>